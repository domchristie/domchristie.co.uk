<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Using Backbone.js Class Properties as Data Stores: Part 2</title>
  <meta name="description" content="A Backbone plugin version of the following can now be found on the backbone-store-collection GitHub repo.">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/2012/08/31/using-backbone-js-class-properties-as-data-stores-part-2.html">
  <link rel="alternate" type="application/rss+xml" title="Dom Christie" href="http://localhost:4000/feed.xml">
</head>

  <body>
    <header role="banner" class="navigation">
  <nav>
    <a href="/" title="Dom Christie Home (Recent Posts)">
      <img src="/domchristie.jpg" alt="" width="24" height="24" />
      <span class="name">Dom Christie</span>
    </a>
    <ul>
      
        
        <li><a href="/about/">About</a></li>
        
      
        
      
        
      
        
      
        
      
      <li><a href="/feed.xml">RSS</a></li>
    </ul>
  </nav>
</header>

    <main class="container">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post__header">
    <time datetime="2012-08-31T16:04:38+01:00" itemprop="datePublished">
      
        31 Aug 2012
      
    </time>

    
      <h1 itemprop="name headline">
        
          Using Backbone.js Class Properties as Data Stores: Part 2
        
      </h1>
    
  </header>
  <div class="post__body" itemprop="articleBody">
    <div class="alert">
<p>A Backbone plugin version of the following can now be found on the <a href="https://github.com/domchristie/backbone-store-collection">backbone-store-collection GitHub repo</a>.</p>
</div>

<p>Previously I demonstrated <a href="http://domchristie.co.uk/posts/31">a pattern to add basic data stores to Backbone models</a>. In this post I&apos;ll improve this pattern, extending the store&apos;s <code>get</code> method to fetch a model from the server if it&apos;s not stored locally.</p>

<p>We&apos;ll want the API to look something like this:</p>

<pre><code>var post = new Blog.Models.Post({ id: 1 });

Blog.Models.Post.store().get(1, {
  success: function(model, response) {
    // model returned from local collection
    model == post; // true
  }
});

Blog.Models.Post.store().get(2, {
  success: function(model, response) {
    // model fetched from the server
  },
  error: function(model, response) {
    // error
  }
});
</code></pre>

<p>As you can see, the new <code>get</code> adds a second parameter, allowing for success/error callbacks.</p>

<p>First we&apos;ll try and retrieve the model from the local store, this requires calling the original <code>get</code> (super). If it&apos;s found, we just invoke the <code>success</code> callback. Otherwise we create a new model with the id that was passed in, fetch that model from the server, then invoke the appropriate callback. (On <code>error</code>, the blank model is removed from the store.)</p>

<pre><code>Blog.Collections.Posts = Backbone.Collection.extend({

  get: function(id, options) {
    var modelFromStore =
      Backbone.Collection.prototype.get.call(this, id);

    if(modelFromStore) {
      options.success(modelFromStore);
    }
    else {
      var newModel = new this.model({ id: id }),
          _this = this;
      newModel.fetch({
        success: options.success,
        error: function(model, response) {
          _this.remove(model);
          options.error(model, response);
        }
      });
    }
  },

  url: &apos;/posts&apos;
});
</code></pre>

<p>I&apos;ve created Backbone plugin for this, available from the <a href="https://github.com/domchristie/backbone-store-collection">backbone-store-collection GitHub repo</a>. So rather than copying the code above, you can simply do something like:</p>

<pre><code>Blog.Collections.Posts = Backbone.StoreCollection.extend({
  url: &apos;/posts&apos;
});
</code></pre>

<p>Models still need to be manually added to the store: see the <a href="https://github.com/domchristie/backbone-store-collection/blob/master/README.md">project readme</a>.</p>
  </div>
</article>



    </main>
  </body>
</html>
