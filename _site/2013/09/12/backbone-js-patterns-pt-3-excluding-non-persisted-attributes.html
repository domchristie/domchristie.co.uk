<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Backbone.js Patterns Pt.3: Excluding non-persisted attributes</title>
  <meta name="description" content="As I mentioned in the previous post, the toJSON method is used to customise the data sent to the server.">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/2013/09/12/backbone-js-patterns-pt-3-excluding-non-persisted-attributes.html">
  <link rel="alternate" type="application/rss+xml" title="Dom Christie" href="http://localhost:4000/feed.xml">
</head>

  <body>
    <header role="banner" class="navigation">
  <nav>
    <a href="/" title="Dom Christie Home (Recent Posts)">
      <img src="/domchristie.jpg" alt="" width="24" height="24" />
      <span class="name">Dom Christie</span>
    </a>
    <ul>
      
        
        <li><a href="/about/">About</a></li>
        
      
        
      
        
      
        
      
        
      
      <li><a href="/feed.xml">RSS</a></li>
    </ul>
  </nav>
</header>

    <main class="container">
      <div class="post-navigation">
  <a href="/"><span aria-label="Back to">‚Üê</span> Posts</a>
</div>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post__header">
    <time datetime="2013-09-12T08:50:07+01:00" itemprop="datePublished">
      
        12 Sep 2013
      
    </time>

    
      <h1 itemprop="name headline">
        
          Backbone.js Patterns Pt.3: Excluding non-persisted attributes
        
      </h1>
    
  </header>
  <div class="post__body" itemprop="articleBody">
    <p>As I mentioned in <a href="http://domchristie.co.uk/posts/79">the previous post</a>, the <code>toJSON</code> method is used to customise the data sent to the server.</p>

<p>Often you&#x2019;ll have attributes on your model that you don&#x2019;t want to be persisted e.g. <code>isSelected</code>. You could customise the <code>toJSON</code> method on a model-by-model basis, but given that excluding attributes is quite common, we can just include a list of attributes we&#x2019;d like removed, and modify <code>Backbone.Model.prototype.toJSON</code>, to handle it.</p>

<p>First, we&#x2019;ll add an <code>excludeFromJSON</code> property to the class definition. This should be an array of attribute keys you&apos;d like to exclude:</p>

<pre><code>var Post = Backbone.Model.extend({
  excludeFromJSON: [ &apos;isSelected&apos; ]
});
</code></pre>

<p>We can then build on our previous <code>toJSON</code> method to exclude those attributes:</p>

<pre><code>(function() {
  var oldToJSON = Backbone.Model.prototype.toJSON;
  Backbone.Model.prototype.toJSON = function() {
    var json = oldToJSON.apply(this, arguments),
        excludeFromJSON = this.excludeFromJSON;
    if(excludeFromJSON) {
      _.each(excludeFromJSON, function(key) {
        delete json[key];
      });
    }
    return humps.decamelizeKeys(json);
  };
})();
</code></pre>

<p>This new <code>Backbone.Model.prototype.toJSON</code> calls the old method to retrieve a copy of the model&apos;s attributes, then deletes any properties whose keys are in the <code>excludeFromJSON</code> array. The modified attributes are finally &#x201C;decamelized&#x201D;. If you don&#x2019;t wish to include <a href="https://github.com/domchristie/humps">my humps library</a>, then just <code>return json;</code>.</p>

<p>Feedback/questions welcome via <a href="https://twitter.com/domchristie">Twitter</a>, or <a href="mailto:christiedom@gmail.com">email</a>.</p>
  </div>
</article>


<div class="post-navigation post-navigation--older-newer">
  
    <a class="post-navigation__older" href="/2013/09/11/watch.html">Previous Post</a>
  
  
    <a class="post-navigation__newer" href="/2013/09/17/dieter-rams-on-good-design.html">Next post</a>
  
</div>


    </main>
  </body>
</html>
